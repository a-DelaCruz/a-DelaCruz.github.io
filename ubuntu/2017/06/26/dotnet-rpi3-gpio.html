<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>My Notes on Single Board Computer by </title>
    <link rel="stylesheet" href="/a-DelaCruz.github.io/assets/css/style.css?v=">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  
  <body>
    <div class="wrapper">
      <header>
        <img src="/assets/img/AJ.png"/>
        <h1>My Notes on Single Board Computer</h1>
        <p>Raspberry Pi 3 - 64-Bit kernel and arm64 rootfs
</p>

        

        

        
      </header>
      <section>

      
<div class="top-nav">
  	<nav>
        		<li><a href="/" >Home</a></li>       
	</nav>
</div>
	



<div class="post-org">

	<h2>Raspberry Pi 3: simple GPIO on .Net Core inside Docker using bcm2835 library</h2>	
	<p class="meta">26 Jun 2017</p>

	<div class="post">
	  <p>I wan’t to try .Net Core on linux-arm64… but unfortunately, there’s no available yet except Win-arm64 and linux-arm32. So instead of using qemu for VM inside RPi3… i encounter docker and try it out. For now i’ll use ubuntu-arm32 as the base image then later try alpine-linux.</p>

<h4 id="prerequisites"><a href="#header-4"></a>Prerequisites:</h4>
<ul>
  <li><a href="https://github.com/dotnet/core-setup/files/716356/dotnet-ubuntu.16.04-arm.1.2.0-beta-001291-00.tar.gz">dotnet-runtime-latest-linux-arm.tar.gz</a></li>
  <li><a href="http://www.airspayce.com/mikem/bcm2835/bcm2835-1.52.tar.gz">bcm2835-1.52.tar.gz</a></li>
  <li>.Net Core SDK   // on your developtment host</li>
  <li>libbcm2835.so   // We’ll create from bcm2835-library</li>
  <li>docker.io       // To be installed on our RPi3</li>
  <li>make            // To be installed inside docker</li>
  <li>gcc             // To be installed inside docker</li>
</ul>

<p>###Docker Container
Assuming you already install <code class="highlighter-rouge">docker.io</code>. Go ahead and pull an armhf/ubuntu image to be use.</p>
<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo docker pull armhf/ubuntu     //This is what i use for now
</code></pre>
</div>

<p>Then run it using these command:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo docker run -it --privileged -p 5000:5000 -v /home/user:/home/share armhf/ubuntu
</code></pre>
</div>
<p>#####Note: Docker options that we’’ use</p>
<div class="highlighter-rouge"><pre class="highlight"><code>--t
-v  /[folder to share]:/[folder destination]
-p  5000:5000   //port to expose. [any port you like on host]:[any port you'll set on .net core]
--privileged    //to have acces on /dev/mem
</code></pre>
</div>

<p>Then install these packages for .Net Core:</p>
<div class="highlighter-rouge"><pre class="highlight"><code># apt-get install libunwind8 libunwind8-dev gettext libicu-dev liblttng-ust-dev libcurl4-openssl-dev libssl-dev uuid-dev
# apt-get install make gcc      // can be remove after we created our libbcm2835.so
</code></pre>
</div>

<p>We’re going to extract <code class="highlighter-rouge">dotnet-runtime-latest-linux-arm.tar.gz</code> in /opt/dotnet.</p>
<div class="highlighter-rouge"><pre class="highlight"><code># mkdir /opt/dotnet
# tar -zxvf dotnet-runtime-latest-linux-arm.tar.gz -C /opt
# /opt/dotnet/dotnet    //Then run this to check that it works. or ./dotnet inside the dotnet folder
</code></pre>
</div>

<p>Extract <code class="highlighter-rouge">bcm2835-1.52.tar.gz</code> anywhere you like, because where going to remove it once we have libbcm2835.so</p>
<div class="highlighter-rouge"><pre class="highlight"><code># tar -zxvf bcm2835-1.52.tar.gz
# cd bcm2835-1.52/src
# gcc -fPIC -c bcm2835.c
# gcc -shared bcm2835.o -o libbcm2835.so
</code></pre>
</div>

<p>You can now remove the bcm2835-1.52 folder and be sure to put libbcm2835.so inside <code class="highlighter-rouge">/lib/arm-</code> folder.
And now lets exit docker and save our updated docker image.</p>
<div class="highlighter-rouge"><pre class="highlight"><code># exit
$ sudo docker commit $(sudo docker ps -aq) armhf/ubuntu     // # sudo docker ps -aq get the id of the docker image we just exited.
</code></pre>
</div>

<p>Reference:
https://dotnetcorechris.github.io/dotnetcoreonraspberrypi.html
http://www.yolinux.com/TUTORIALS/LibraryArchives-StaticAndDynamic.html</p>

	</div>

<!-- Comments -->
<div class="comments">
	
<!-- Add Disqus comments. -->
<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'a-delacruz'; // required: replace example with your forum shortname
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>




</div>

</div>


      </section>
      <footer>
        <p><small>Email &mdash; <a href="mailto:delacruzallanjay@gmail.com">Gmail</a></small>
        <small>Wordpress &mdash; <a href="https://cranzblog.wordpress.com">Blog</a></small></p>
      </footer>
    </div>
    <script src="/a-DelaCruz.github.io/assets/js/scale.fix.js"></script>


  
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-99256627-1', 'auto');
        ga('send', 'pageview');
    </script>
  
  </body>
</html>
