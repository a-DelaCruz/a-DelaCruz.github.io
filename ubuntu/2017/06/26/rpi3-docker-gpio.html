<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>RPi 3: GPIO on .Net Core inside Docker using bcm2835 library: #1</title>

    <link rel="stylesheet" href="/a-DelaCruz.github.io/assets/css/style.css?v=">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <link rel="shortcut icon" type="image/png" href="/a-DelaCruz.github.io /assets/img/AJ.png ">
    
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({google_ad_client: "ca-pub-6013311002995151", enable_page_level_ads: true});
    </script>
</head>

    <body>
        <div class="wrapper-header">
  <div class="logo">
      <img src="/assets/img/AJ.png" />
  </div>
  <div class="ads">
      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <!-- Ad-1 -->
        <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6013311002995151" data-ad-slot="2377202477" data-ad-format="auto"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
  </div>
</div>
        
        <main>
            
            <article>
                <div class="wrapper-blog">
    <div class="blog-navi-left">
        <div class="navi-left">
    <ul class="navi-left-item">
        <li>
            <a href="/">
                <img class="navi-left" src="/assets/img/home.png" />
            </a>
        </li>
        <li>
            <a href="mailto:delacruzallanjay@gmail.com">
                <img class="navi-left" src="/assets/img/email.png" />
            </a>
        </li>
        <li>
            <a href="https://cranzblog.wordpress.com">
                <img class="navi-left" src="/assets/img/wordpress.png" />
            </a>
        </li>
    </ul>
</div>
    </div>
    <div class="blog">
        <div class="blog-title">
            <h2>RPi 3: GPIO on .Net Core inside Docker using bcm2835 library: #1</h2>
        </div>
        <div class="blog-date">
            <time>06/26/17</time>
            </div>
        <div class="blog-content">
            <p>I wan’t to try .Net Core on linux-arm64… but unfortunately, there’s no available yet except Win-arm64 and linux-arm32. So instead of using qemu for VM inside RPi3… i encounter docker and try it out. For now i’ll use ubuntu-arm32 as the base image then later try alpine-linux.</p>

<h4 id="prerequisites">Prerequisites:</h4>
<ul>
  <li><a href="https://github.com/dotnet/core-setup/files/716356/dotnet-ubuntu.16.04-arm.1.2.0-beta-001291-00.tar.gz">dotnet-runtime-latest-linux-arm.tar.gz</a></li>
  <li><a href="http://www.airspayce.com/mikem/bcm2835/bcm2835-1.52.tar.gz">bcm2835-1.52.tar.gz</a></li>
  <li><code class="highlighter-rouge">.Net Core SDK</code>     // on your developtment host</li>
  <li><code class="highlighter-rouge">libbcm2835.so</code>     // We’ll create from bcm2835-library</li>
  <li><code class="highlighter-rouge">docker.io</code>         // To be installed on our RPi3</li>
  <li><code class="highlighter-rouge">make</code>              // To be installed inside docker</li>
  <li><code class="highlighter-rouge">gcc</code>              // To be installed inside docker</li>
</ul>

<h3 id="docker-container">Docker Container</h3>
<p>Assuming you already install <code class="highlighter-rouge">docker.io</code>. Go ahead and pull an armhf/ubuntu image to be use.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo docker pull armhf/ubuntu     //This is what i use for now
</code></pre></div></div>

<p>Then run it using these command:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo docker run -it --privileged -p 5000:5000 -v /home/user:/home/share armhf/ubuntu
</code></pre></div></div>
<h5 id="note-docker-options-that-well-use">Note: Docker options that we’ll use:</h5>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-it
-v  /[folder to share]:/[folder destination]
-p  5000:5000   //port to expose. [any port you like on host]:[any port you'll set on .net core]
--privileged    //to have acces on /dev/mem
</code></pre></div></div>

<p>Then install these packages for <code class="highlighter-rouge">.Net Core</code>:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># apt-get install libunwind8 libunwind8-dev gettext libicu-dev liblttng-ust-dev libcurl4-openssl-dev libssl-dev uuid-dev
# apt-get install make gcc      // can be remove after we created our libbcm2835.so
</code></pre></div></div>

<p>We’re going to extract <code class="highlighter-rouge">dotnet-runtime-latest-linux-arm.tar.gz</code> in <code class="highlighter-rouge">/opt/dotnet</code> folder.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># mkdir /opt/dotnet
# tar -zxvf dotnet-runtime-latest-linux-arm.tar.gz -C /opt/dotnet
# ln -s /opt/dotnet/dotnet /usr/bin/dotnet 
# dotnet --info           // to verify that it works
</code></pre></div></div>

<p>Extract <code class="highlighter-rouge">bcm2835-1.52.tar.gz</code> anywhere you like, because where going to remove it once we have <code class="highlighter-rouge">libbcm2835.so</code>.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># tar -zxvf bcm2835-1.52.tar.gz
# cd bcm2835-1.52/src
# gcc -fPIC -c bcm2835.c
# gcc -shared bcm2835.o -o libbcm2835.so
</code></pre></div></div>

<p>You can now remove the <code class="highlighter-rouge">bcm2835-1.52 folder</code> and be sure to put <code class="highlighter-rouge">libbcm2835.so</code> inside <code class="highlighter-rouge">/lib/arm-</code> folder.
And now lets exit docker and save our updated docker image.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># exit
$ sudo docker commit $(sudo docker ps -aq) armhf/ubuntu     // # sudo docker ps -aq get the id of the docker image we just exited.
</code></pre></div></div>

<h3 id="net-core">.Net Core</h3>
<p>Once <code class="highlighter-rouge">.Net Core SDK</code> is installed, create a simple console application that we can try to test first. I use windows for development. So from cmd prompt i ran this command to create a test app.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; dotnet new console -n testapp
</code></pre></div></div>

<p>Then make sure the we have the same configuration like this for our test app in <code class="highlighter-rouge">testapp.csproj</code>:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="nt">&lt;Project</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;OutputType&gt;</span>Exe<span class="nt">&lt;/OutputType&gt;</span>
    <span class="nt">&lt;TargetFramework&gt;</span>netcoreapp2.0<span class="nt">&lt;/TargetFramework&gt;</span>
    <span class="nt">&lt;RuntimeFrameworkVersion&gt;</span>2.0.0-preview1-002028-00<span class="nt">&lt;/RuntimeFrameworkVersion&gt;</span>
    <span class="nt">&lt;RuntimeIdentifiers&gt;</span>ubuntu.16.04-arm<span class="nt">&lt;/RuntimeIdentifiers&gt;</span>
  <span class="nt">&lt;/PropertyGroup&gt;</span>
<span class="nt">&lt;/Project&gt;</span>
</code></pre></div></div>

<p>For now aside from the above… we’ll leave everything as it is and then run these commands:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; cd testapp
testapp&gt; dotnet restore .
testapp&gt; dotnet build .
testapp&gt; dotnet publish -r ubuntu.16.04-arm   //or use a generic 'linux-arm' as runtime
</code></pre></div></div>

<p>The command <code class="highlighter-rouge">dotnet publish -r ubuntu.16.04-arm</code> will create the necessary files that we need to run our console app in ubuntu.
Now let’s go to: <code class="highlighter-rouge">/testapp/bin/debug/netcoreapp2.0/ubuntu.16.04-arm</code> folder and the <code class="highlighter-rouge">/publish folder</code> is what we need to copy into our RPi3. You can use any SFTP app you like to do it. Once your done transfering that folder… let’s navigate into it and test if it will run. let us run again our docker image above and then In my case i’ll use this as my shared folder: <code class="highlighter-rouge">/home/pi3:/home/share</code> [my RPi3 folder]:[docker folder that is created automatically]</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo docker run -it --privileged -p 5000:5000 -v /home/pi3:/home/share armhf/ubuntu
# cd /home/share/publish
# /opt/dotnet/dotnet ./testapp.dll

    Hellow World!
</code></pre></div></div>

<p>Those last 2 commands are run inside the docker image. Yes! it’s alive…Now for the <a href="../27/rpi3-docker-gpio-2">part 2</a></p>

<h5 id="reference">Reference:</h5>
<ul>
  <li><a href="https://dotnetcorechris.github.io/dotnetcoreonraspberrypi.html">https://dotnetcorechris.github.io/dotnetcoreonraspberrypi.html</a></li>
  <li><a href="http://www.yolinux.com/TUTORIALS/LibraryArchives-StaticAndDynamic.html">http://www.yolinux.com/TUTORIALS/LibraryArchives-StaticAndDynamic.html</a></li>
  <li><a href="https://jeremylindsayni.wordpress.com/2017/04/02/installing-ubuntu-16-04-on-a-raspberry-pi-3-installing-net-core-2-and-running-a-sample-net-core-2-app/">https://jeremylindsayni.wordpress.com/2017/04/02/installing-ubuntu-16-04-on-a-raspberry-pi-3-installing-net-core-2-and-running-a-sample-net-core-2-app/</a></li>
</ul>

<hr />



            <!-- Comments -->
            <div class="comments">
                <!-- Add Disqus comments. -->

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'a-delacruz'; // required: replace example with your forum shortname
    // var disqus_developer = 1; // Comment out when the site is live
    var disqus_identifier = "/ubuntu/2017/06/26/rpi3-docker-gpio.html";

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by
    <span class="logo-disqus">Disqus</span>
</a>
            </div>
        </div>
    </div>
</div>
            </article>
        </main>

        <script src="/a-DelaCruz.github.io/assets/js/scale.fix.js"></script>
        
        <!-- Google Analytics -->
        
            <script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
                ga('create', 'UA-99256627-1', 'auto');
                ga('send', 'pageview');
            </script>
        
        
    </body>
    
</html>